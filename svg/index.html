<!DOCTYPE html>
<!-- Freecell using svg for the cards -->
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>SVG Cards</title>
  <style>
    body {background:green;padding:0;margin:0;font-family:sans-serif;}
    p, p>a {color:white;}
    div.row {display:flex; flex-wrap:nowrap; flex-direction:row; justify-content:space-evenly;}
  div.a {position:absolute;background:red;color:white;top:40%;left:40%;padding:1vw;font-size:3vw;}
  div.s {width:10%;height:14vw; background:lightgreen;}
  div.c {height:80vw;width:10%;position:relative;}
  div.r {line-height:85%; letter-spacing:80%; font-size:14vw; color:red; background:white;}
  div.b {line-height:85%; letter-spacing:80%; font-size:14vw; background:white;}
  </style>
  <link rel="icon" href="/favicon.ico" type="image/x-icon" />
</head>
  
<body>
  <p><a href=/>&#9776;</a> SVG Freecell 0.1k <button onclick="startGame()">Shuffle</button></p>
  <div class=row>
  <div id=s0 class=s onclick="tempAlert('Freecell 0',1000)"></div>
  <div id=s1 class=s onclick="alert('Freecell 1')"></div>
  <div id=s2 class=s onclick="alert('Freecell 2')"></div>
  <div id=s3 class=s onclick="alert('Freecell 3')"></div>
  <div id=s4 class=s onclick="alert('Ace 0')"></div>
  <div id=s5 class=s onclick="alert('Ace 1')"></div>
  <div id=s6 class=s onclick="alert('Ace 2')"></div>
  <div id=s7 class=s onclick="alert('Ace 3')"></div>
</div>
<div class=row><p>&nbsp;</p></div>
<div class=row>
  <div id=c0 class=c onclick="popStack(0)"></div>
  <div id=c1 class=c onclick="popStack(1)"></div>
  <div id=c2 class=c onclick="popStack(2)"></div>
  <div id=c3 class=c onclick="popStack(3)"></div>
  <div id=c4 class=c onclick="popStack(4)"></div>
  <div id=c5 class=c onclick="popStack(5)"></div>
  <div id=c6 class=c onclick="popStack(6)"></div>
  <div id=c7 class=c onclick="popStack(7)"></div>
</div>

<script>
// Set up a 1-d array of the unicode values for the cards 0-51
// Note - Unicode sets up 16 cards per suit, including two queens
// Unlike the old game, I want to only use the DOM 
  cards = []; // array of card div svg objects
  deck = []; // sort order for the cards
  freecells = [-1,-1,-1,-1];
  aces = [-1,-1,-1,-1];
  suits = ["&spadesuit;","&heartsuit;","&diamondsuit;","&clubsuit;"];
  vals = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];

  for (n=0;n<52;n++) { // create 52 svg cards as strings in this array - innerHTML for divs
    deck[n]=n; // start out without a shuffle
    var suit=Math.floor(n/13);
    var f=''; if(suit==1 || suit==2) f=' fill="red"'; // optionally paint the red suits red
    var val = n % 13;
    cards[n]='<svg viewBox="0 0 200 280">'
      + '<rect x="2" y="2" rx="20" ry="20" width="194" height="274" style="fill:white;stroke:black;stroke-width:4;" />'
      + '<text font-size="120" x="97" y="137" text-anchor="middle" alignment-baseline="central"'+f+'>'+suits[suit]+'</text>'
      + '<text x="15" y="45" font-size="45">'+vals[val]+'</text>'
      + '<text x="145" y="50" font-size="45"'+f+'>'+suits[suit]+'</text>'
      + '</svg>';
  }
  // Run through to see if any top cards can jump to the ace pile
  function topCardId(j){
    column=document.getElementById("c"+j);
    topCard = column.lastChild;
    return topCard.id; // what card is it? v0...
  }
  const getSuit = x => Math.floor((x.substring(1).parseInt())/13); 
  const getVal = x => (x.substring(1).parseInt()) % 13; 
  function tryAce(){
    nmove=0; // This gets incremented and returned
    for(j=0;j<8;j++) {
      topID=topCardId(j);
      if(topID) { // is there a top card in this column?
        suit=getSuit(topID);
        val=getVal(topID);
        if(aces[suit]=val-1) {
          nmove++;
          aces[suit]++;
          popCard(j,topID,"a"+suit);
        }
      }
    }
    return nmove;
  }
  function popTop(j) popCard(j,topCardId(j),"a0");
  // Move a card from the top of a column to a new spot
  function popCard(j,srcId,destId){
    column=document.getElementById("c"+j);
    dest=document.getElementById(destId);
    column.removeChild(column.lastChild);
    console.log(srcId+" "+destId);
  }

// a function to shuffle the deck;
  function shuffle(){
    for(i=0; i<100; i++) { // do 100 random interchanges
      j=Math.floor(52*Math.random());
      k=Math.floor(52*Math.random());
      m=deck[j]; deck[j]=deck[k]; deck[k]=m;
    }
  }
// a function to deal the deck into child objects
  function deal(){
    // first make sure the board is clear by removing any children
    for(j=0;j<8;j++) {
      const column=document.getElementById("c"+j);
      while (column.firstChild) column.removeChild(column.firstChild);
    }
    // next, append cards to each column in turn  
    for(i=0;i<52;i++) {
      j=i%8;
      z=1+Math.floor(i/8); // how far down in the stack?
      const column=document.getElementById("c"+j);
      var card=document.createElement("div");
      cardNo=deck[i];
      card.innerHTML=cards[cardNo];
      card.id="v"+cardNo;
      card.style.zindex=j.toString();
      card.style.position='absolute';
      card.style.width='100%';
      y=(z-1)*3;
      card.style.top=y.toString()+"vw";
      column.appendChild(card);
    }
  }
  function startGame(){
    shuffle();
    deal();
    while(tryAce());
  }
  function tempAlert(msg,duration) { // adapted from Travis J on stackoverflow
     var el = document.createElement("div");
     el.className='a';
     el.innerHTML = msg;
     setTimeout(function(){
      el.parentNode.removeChild(el);
     },duration);
     document.body.appendChild(el);
  }

</script>
</body>
</html>
